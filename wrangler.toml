name = "faircount-api"
main = "src/workers/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# Development settings
[dev]
port = 8787

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "faircount-db"
database_id = "local" # Will be replaced with actual ID in production
migrations_dir = "drizzle/migrations"

# R2 Storage (for avatars, exports) - uncomment when ready
# [[r2_buckets]]
# binding = "STORAGE"
# bucket_name = "faircount-storage"

# Environment variables (local development)
[vars]
APP_URL = "http://localhost:8787"
FRONTEND_URL = "http://localhost:3000"
APP_NAME = "FairCount"
GIT_SHA = "dev"
BUILD_DATE = ""

# Production environment
[env.production.vars]
APP_URL = "https://api.sylvaindenyse.me"
FRONTEND_URL = "https://faircount.sylvaindenyse.me"
APP_NAME = "FairCount"

[[env.production.d1_databases]]
binding = "DB"
database_name = "faircount-db"
database_id = "26b8846d-90ed-4933-b505-01b8868fb053"
migrations_dir = "drizzle/migrations"

# Observability - persist logs across deployments
[observability]
enabled = true
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
